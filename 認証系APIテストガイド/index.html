
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../SECURITY_AUDIT_COMMANDS/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>èªè¨¼ç³»APIãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰ - KOIKI-FW v0.6.0</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="KOIKI-FW v0.6.0" class="md-header__button md-logo" aria-label="KOIKI-FW v0.6.0" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KOIKI-FW v0.6.0
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              èªè¨¼ç³»APIãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="KOIKI-FW v0.6.0" class="md-nav__button md-logo" aria-label="KOIKI-FW v0.6.0" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    KOIKI-FW v0.6.0
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    æ¦‚è¦
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../design_kkfw_0.6.0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    KOIKI-FW æ©Ÿèƒ½è¨­è¨ˆãƒ»æ§‹æˆã‚¬ã‚¤ãƒ‰
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../README-deploy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ã‚¢ãƒ—ãƒªãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SECURITY_AUDIT_COMMANDS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ã‚³ãƒãƒ³ãƒ‰
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    èªè¨¼ç³»APIãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    èªè¨¼ç³»APIãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      æ¦‚è¦
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç’°å¢ƒ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç’°å¢ƒ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      å‰ææ¡ä»¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      ãƒ†ã‚¹ãƒˆæ§‹æˆ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ãƒ†ã‚¹ãƒˆæ§‹æˆ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ·ï¸ ãƒ†ã‚¹ãƒˆãƒãƒ¼ã‚«ãƒ¼
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      ç¾åœ¨ã®å®Ÿè¡ŒçŠ¶æ³
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ç¾åœ¨ã®å®Ÿè¡ŒçŠ¶æ³">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#10-passed" class="md-nav__link">
    <span class="md-ellipsis">
      âœ… å‹•ä½œç¢ºèªæ¸ˆã¿ãƒ†ã‚¹ãƒˆï¼ˆ10 passedï¼‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸš§ ä¿®æ­£ãŒå¿…è¦ãªãƒ†ã‚¹ãƒˆ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹ã‚¬ã‚¤ãƒ‰
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹ã‚¬ã‚¤ãƒ‰">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆæ¨å¥¨ï¼‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã®è¨­å®š
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-transactional" class="md-nav__link">
    <span class="md-ellipsis">
      1. @transactionalãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã¨ãƒ¢ãƒƒã‚¯ã®ç«¶åˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      2. çµ±åˆãƒ†ã‚¹ãƒˆã®ãƒ‡ãƒ¼ã‚¿ç«¶åˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-pytest-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      3. pytest-asyncio ã®è­¦å‘Š
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      é–‹ç™ºæ™‚ã®æ¨å¥¨æ‰‹é †
    </span>
  </a>
  
    <nav class="md-nav" aria-label="é–‹ç™ºæ™‚ã®æ¨å¥¨æ‰‹é †">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã™ã‚‹å ´åˆ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      å‚™è€ƒï¼šãƒ†ã‚¹ãƒˆå®Ÿè£…ã§èª¿æ•´ã—ãŸãƒã‚¤ãƒ³ãƒˆ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å‚™è€ƒï¼šãƒ†ã‚¹ãƒˆå®Ÿè£…ã§èª¿æ•´ã—ãŸãƒã‚¤ãƒ³ãƒˆ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-transactional_1" class="md-nav__link">
    <span class="md-ellipsis">
      1. @transactionalãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿å¯¾å¿œ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-pytest-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      2. pytest-asyncio ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºæ™‚ã®ãƒ†ã‚¹ãƒˆæ‰‹é †
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºæ™‚ã®ãƒ†ã‚¹ãƒˆæ‰‹é †">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ†ã‚¹ãƒˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-api" class="md-nav__link">
    <span class="md-ellipsis">
      2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³APIã®ãƒ†ã‚¹ãƒˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    <span class="md-ellipsis">
      3. æ¨å¥¨é–‹ç™ºãƒ•ãƒ­ãƒ¼
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      æ¦‚è¦
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç’°å¢ƒ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç’°å¢ƒ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      å‰ææ¡ä»¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      ãƒ†ã‚¹ãƒˆæ§‹æˆ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ãƒ†ã‚¹ãƒˆæ§‹æˆ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ·ï¸ ãƒ†ã‚¹ãƒˆãƒãƒ¼ã‚«ãƒ¼
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      ç¾åœ¨ã®å®Ÿè¡ŒçŠ¶æ³
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ç¾åœ¨ã®å®Ÿè¡ŒçŠ¶æ³">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#10-passed" class="md-nav__link">
    <span class="md-ellipsis">
      âœ… å‹•ä½œç¢ºèªæ¸ˆã¿ãƒ†ã‚¹ãƒˆï¼ˆ10 passedï¼‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸš§ ä¿®æ­£ãŒå¿…è¦ãªãƒ†ã‚¹ãƒˆ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹ã‚¬ã‚¤ãƒ‰
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹ã‚¬ã‚¤ãƒ‰">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆæ¨å¥¨ï¼‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã®è¨­å®š
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-transactional" class="md-nav__link">
    <span class="md-ellipsis">
      1. @transactionalãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã¨ãƒ¢ãƒƒã‚¯ã®ç«¶åˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      2. çµ±åˆãƒ†ã‚¹ãƒˆã®ãƒ‡ãƒ¼ã‚¿ç«¶åˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-pytest-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      3. pytest-asyncio ã®è­¦å‘Š
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      é–‹ç™ºæ™‚ã®æ¨å¥¨æ‰‹é †
    </span>
  </a>
  
    <nav class="md-nav" aria-label="é–‹ç™ºæ™‚ã®æ¨å¥¨æ‰‹é †">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã™ã‚‹å ´åˆ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      å‚™è€ƒï¼šãƒ†ã‚¹ãƒˆå®Ÿè£…ã§èª¿æ•´ã—ãŸãƒã‚¤ãƒ³ãƒˆ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å‚™è€ƒï¼šãƒ†ã‚¹ãƒˆå®Ÿè£…ã§èª¿æ•´ã—ãŸãƒã‚¤ãƒ³ãƒˆ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-transactional_1" class="md-nav__link">
    <span class="md-ellipsis">
      1. @transactionalãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿å¯¾å¿œ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-pytest-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      2. pytest-asyncio ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºæ™‚ã®ãƒ†ã‚¹ãƒˆæ‰‹é †
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºæ™‚ã®ãƒ†ã‚¹ãƒˆæ‰‹é †">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ†ã‚¹ãƒˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-api" class="md-nav__link">
    <span class="md-ellipsis">
      2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³APIã®ãƒ†ã‚¹ãƒˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    <span class="md-ellipsis">
      3. æ¨å¥¨é–‹ç™ºãƒ•ãƒ­ãƒ¼
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="api">èªè¨¼ç³»APIãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰</h1>
<p><strong>æ›´æ–°æ—¥</strong>: 2025-07-17<br />
<strong>å¯¾è±¡ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯</strong>: KOIKI-FW v0.6.0<br />
<strong>ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯</strong>: pytest + FastAPI TestClient + pytest-asyncio  </p>
<h2 id="_1">æ¦‚è¦</h2>
<p>ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€KOIKI-FWã«ãŠã‘ã‚‹èªè¨¼ç³»APIã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•ã¨ã€ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ã€<strong>ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ</strong>ã¨<strong>çµ±åˆãƒ†ã‚¹ãƒˆ</strong>ã®2å±¤æ§‹é€ ã§ã€åŠ¹ç‡çš„ã§ä¿å®ˆæ€§ã®é«˜ã„ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚</p>
<h2 id="_2">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç’°å¢ƒ</h2>
<h3 id="_3">å‰ææ¡ä»¶</h3>
<pre><code class="language-bash"># å¿…è¦ãªã‚µãƒ¼ãƒ“ã‚¹ã®èµ·å‹•
docker-compose up -d db

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
poetry install --with test
</code></pre>
<h3 id="_4">åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h3>
<pre><code class="language-bash"># âœ… æ¨å¥¨ï¼šå‹•ä½œç¢ºèªæ¸ˆã¿ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
poetry run pytest tests/unit/test_simple_auth.py tests/unit/test_hello.py tests/unit/libkoiki/services/test_user_service_simple.py tests/integration/app/api/test_todos_api.py -v

# âœ… åŸºæœ¬çš„ãªãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
poetry run pytest tests/unit/test_simple_auth.py -v

# âœ… èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚·ãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆ
poetry run pytest tests/unit/libkoiki/services/test_user_service_simple.py -v

# âœ… çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¿…è¦ï¼‰
poetry run pytest tests/integration/app/api/test_todos_api.py -v
</code></pre>
<h3 id="_5">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆ</h3>
<pre><code class="language-bash"># PostgreSQLã‚’èµ·å‹•
docker-compose up -d db

# å€‹åˆ¥ã®çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
poetry run pytest tests/integration/services/test_user_service_db.py::TestUserServiceDatabase::test_create_user_success -v

# çµ±åˆãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å¾Œï¼‰
docker-compose exec db psql -U koiki_user -d koiki_todo_db -c &quot;DELETE FROM refresh_tokens; DELETE FROM login_attempts; DELETE FROM users;&quot;
poetry run pytest tests/integration/services/test_user_service_db.py::TestUserServiceDatabase::test_create_user_success -v
</code></pre>
<h2 id="_6">ãƒ†ã‚¹ãƒˆæ§‹æˆ</h2>
<h3 id="_7">ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ </h3>
<pre><code>tests/
â”œâ”€â”€ conftest.py                                          # å…±é€šãƒ†ã‚¹ãƒˆè¨­å®š
â”œâ”€â”€ integration/
â”‚   â”œâ”€â”€ app/api/
â”‚   â”‚   â””â”€â”€ test_todos_api.py                           # APIçµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ test_user_service_db.py                     # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ DBçµ±åˆãƒ†ã‚¹ãƒˆ
â”‚       â”œâ”€â”€ test_auth_service_db.py                     # èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ DBçµ±åˆãƒ†ã‚¹ãƒˆ
â”‚       â””â”€â”€ test_login_security_service_db.py           # ãƒ­ã‚°ã‚¤ãƒ³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ DBçµ±åˆãƒ†ã‚¹ãƒˆ
â””â”€â”€ unit/
    â”œâ”€â”€ test_simple_auth.py                             # ã‚·ãƒ³ãƒ—ãƒ«ãªèªè¨¼ãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ test_hello.py                                   # åŸºæœ¬ãƒ†ã‚¹ãƒˆ
    â””â”€â”€ libkoiki/services/
        â”œâ”€â”€ test_user_service_simple.py                 # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ ã‚·ãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆ âœ…
        â”œâ”€â”€ test_user_service.py                        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ è¤‡åˆãƒ†ã‚¹ãƒˆï¼ˆä¿®æ­£ä¸­ï¼‰
        â”œâ”€â”€ test_auth_service_comprehensive.py          # èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ åŒ…æ‹¬ãƒ†ã‚¹ãƒˆï¼ˆä¿®æ­£ä¸­ï¼‰
        â””â”€â”€ test_login_security_service.py              # ãƒ­ã‚°ã‚¤ãƒ³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆï¼ˆä¿®æ­£ä¸­ï¼‰
</code></pre>
<h3 id="_8">ğŸ·ï¸ ãƒ†ã‚¹ãƒˆãƒãƒ¼ã‚«ãƒ¼</h3>
<table>
<thead>
<tr>
<th>ãƒãƒ¼ã‚«ãƒ¼</th>
<th>èª¬æ˜</th>
<th>DBå¿…è¦</th>
<th>å®Ÿè¡Œé€Ÿåº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@pytest.mark.unit</code></td>
<td>ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆï¼‰</td>
<td>âŒ</td>
<td>é«˜é€Ÿ</td>
</tr>
<tr>
<td><code>@pytest.mark.integration</code></td>
<td>çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆDBä½¿ç”¨ï¼‰</td>
<td>âœ…</td>
<td>ä¸­é€Ÿ</td>
</tr>
</tbody>
</table>
<h2 id="_9">ç¾åœ¨ã®å®Ÿè¡ŒçŠ¶æ³</h2>
<h3 id="10-passed">âœ… å‹•ä½œç¢ºèªæ¸ˆã¿ãƒ†ã‚¹ãƒˆï¼ˆ10 passedï¼‰</h3>
<pre><code class="language-bash"># æ¨å¥¨å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰
poetry run pytest tests/unit/test_simple_auth.py tests/unit/test_hello.py tests/unit/libkoiki/services/test_user_service_simple.py tests/integration/app/api/test_todos_api.py -v

# çµæœ: 10 passed, 12 warnings
</code></pre>
<p><strong>å†…è¨³</strong>:
- åŸºæœ¬èªè¨¼ãƒ†ã‚¹ãƒˆ: 3ä»¶
- Hello worldãƒ†ã‚¹ãƒˆ: 1ä»¶<br />
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ ã‚·ãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆ: 5ä»¶
- TODOs APIçµ±åˆãƒ†ã‚¹ãƒˆ: 1ä»¶</p>
<h3 id="_10">ğŸš§ ä¿®æ­£ãŒå¿…è¦ãªãƒ†ã‚¹ãƒˆ</h3>
<p><strong>@transactionalãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿é–¢é€£ã®è¤‡é›‘ãªãƒ†ã‚¹ãƒˆ</strong>:</p>
<pre><code class="language-bash"># ç¾åœ¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
poetry run pytest tests/unit/libkoiki/services/test_user_service.py -v
poetry run pytest tests/unit/libkoiki/services/test_auth_service_comprehensive.py -v
poetry run pytest tests/integration/app/api/test_auth_api.py -v
</code></pre>
<p><strong>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆ</strong>:</p>
<pre><code class="language-bash"># å€‹åˆ¥å®Ÿè¡Œã¯æˆåŠŸã€è¤‡æ•°å®Ÿè¡Œæ™‚ã«ãƒ‡ãƒ¼ã‚¿ç«¶åˆ
poetry run pytest tests/integration/services/ -v
</code></pre>
<h2 id="_11">ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹ã‚¬ã‚¤ãƒ‰</h2>
<h3 id="1">1. ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆæ¨å¥¨ï¼‰</h3>
<p><strong>ç‰¹å¾´</strong>:
- @transactionalãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã‚’ãƒã‚¤ãƒ‘ã‚¹
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç›´æ¥ãƒ†ã‚¹ãƒˆ
- é«˜é€Ÿã§å®‰å®š</p>
<p><strong>ä¾‹</strong>: <code>tests/unit/libkoiki/services/test_user_service_simple.py</code></p>
<pre><code class="language-python">&quot;&quot;&quot;ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ ã‚·ãƒ³ãƒ—ãƒ«ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ&quot;&quot;&quot;
import pytest
from unittest.mock import AsyncMock, MagicMock, patch
from libkoiki.services.user_service import UserService
from libkoiki.models.user import UserModel
from libkoiki.schemas.user import UserCreate

class TestUserServiceSimple:
    &quot;&quot;&quot;ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ ã‚·ãƒ³ãƒ—ãƒ«ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ&quot;&quot;&quot;

    @patch('libkoiki.services.user_service.get_password_hash')
    @patch('libkoiki.services.user_service.check_password_complexity')
    @patch('libkoiki.services.user_service.increment_user_registration')
    @pytest.mark.asyncio
    async def test_create_user_logic_success(
        self,
        mock_increment_user_registration,
        mock_check_password,
        mock_get_password_hash,
        mock_user_repo,
        mock_event_publisher,
        user_create_data,
        mock_user,
        mock_db_session
    ):
        &quot;&quot;&quot;ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆãƒ­ã‚¸ãƒƒã‚¯æˆåŠŸãƒ†ã‚¹ãƒˆ&quot;&quot;&quot;
        # ç›´æ¥ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆ
        from libkoiki.services.user_service import UserService

        # ãƒ¢ãƒƒã‚¯ã®è¨­å®š
        mock_check_password.return_value = True
        mock_get_password_hash.return_value = &quot;hashed_password&quot;
        mock_user_repo.get_by_email = AsyncMock(return_value=None)
        mock_user_repo.create = AsyncMock(return_value=mock_user)

        # ã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
        user_service = UserService(mock_user_repo, mock_event_publisher)

        # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ®µéšçš„ã«ãƒ†ã‚¹ãƒˆ
        # 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®š
        user_service.repository.set_session(mock_db_session)

        # 2. é‡è¤‡ãƒã‚§ãƒƒã‚¯
        existing_user = await user_service.repository.get_by_email(user_create_data.email)
        assert existing_user is None

        # 3. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼
        password_valid = mock_check_password(user_create_data.password)
        assert password_valid is True

        # 4. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–
        hashed_password = mock_get_password_hash(user_create_data.password)
        assert hashed_password == &quot;hashed_password&quot;

        # 5. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
        user_data = user_create_data.model_dump(exclude={&quot;password&quot;})
        user_data[&quot;hashed_password&quot;] = hashed_password
        new_user = UserModel(**user_data)
        created_user = await user_service.repository.create(new_user)

        # 6. çµæœæ¤œè¨¼
        assert created_user == mock_user
        assert created_user.email == &quot;test@example.com&quot;
</code></pre>
<h3 id="2">2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆ</h3>
<p><strong>ç‰¹å¾´</strong>:
- å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ç”¨
- @transactionalãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã¨å”èª¿
- ãƒªã‚¢ãƒ«ãªå‹•ä½œç¢ºèª</p>
<p><strong>ä¾‹</strong>: <code>tests/integration/services/test_user_service_db.py</code></p>
<pre><code class="language-python">&quot;&quot;&quot;ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆ&quot;&quot;&quot;
import pytest
from unittest.mock import patch
from libkoiki.schemas.user import UserCreate

@pytest.mark.integration
class TestUserServiceDatabase:
    &quot;&quot;&quot;ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆ&quot;&quot;&quot;

    @patch('libkoiki.services.user_service.check_password_complexity')
    @pytest.mark.asyncio
    async def test_create_user_success(
        self,
        mock_check_password,
        test_services,
        test_db_session
    ):
        &quot;&quot;&quot;ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆæˆåŠŸãƒ†ã‚¹ãƒˆï¼ˆå®Ÿéš›ã®DBä½¿ç”¨ï¼‰&quot;&quot;&quot;
        # ãƒ¢ãƒƒã‚¯ã®è¨­å®š
        mock_check_password.return_value = True

        # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
        user_data = UserCreate(
            email=&quot;integration_test@example.com&quot;,
            password=&quot;TestPass123@&quot;,
            full_name=&quot;Integration Test User&quot;
        )

        # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        user_service = test_services[&quot;user_service&quot;]
        created_user = await user_service.create_user(user_data, test_db_session)

        # çµæœæ¤œè¨¼
        assert created_user is not None
        assert created_user.email == &quot;integration_test@example.com&quot;
        assert created_user.full_name == &quot;Integration Test User&quot;
</code></pre>
<h3 id="3">3. ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã®è¨­å®š</h3>
<p><strong>conftest.py</strong>ã®é‡è¦ãªè¨­å®š:</p>
<pre><code class="language-python">@pytest_asyncio.fixture
async def test_db_session(test_engine) -&gt; AsyncGenerator[AsyncSession, None]:
    &quot;&quot;&quot;ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒã‚·ãƒ§ãƒ³ - @transactionalãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã¨å”èª¿&quot;&quot;&quot;
    async_session_factory = sessionmaker(
        test_engine, class_=AsyncSession, expire_on_commit=False
    )

    async with async_session_factory() as session:
        yield session
        # @transactionalãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãŒãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç®¡ç†

@pytest_asyncio.fixture
async def test_services(test_repositories):
    &quot;&quot;&quot;ãƒ†ã‚¹ãƒˆç”¨ã‚µãƒ¼ãƒ“ã‚¹&quot;&quot;&quot;
    # ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
    user_service = UserService(
        repository=test_repositories[&quot;user_repo&quot;],
        event_publisher=None  # ãƒ†ã‚¹ãƒˆã§ã¯ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã‚’ç„¡åŠ¹åŒ–
    )

    return {
        &quot;user_service&quot;: user_service,
        &quot;auth_service&quot;: auth_service,
        &quot;login_security_service&quot;: login_security_service,
    }
</code></pre>
<h2 id="_12">ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š</h2>
<pre><code class="language-bash"># ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆå®Ÿè¡Œ
poetry run pytest --cov=app --cov=libkoiki --cov-report=term-missing tests/unit/test_simple_auth.py tests/unit/test_hello.py tests/unit/libkoiki/services/test_user_service_simple.py tests/integration/app/api/test_todos_api.py

# HTMLãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
poetry run pytest --cov=app --cov=libkoiki --cov-report=html tests/unit/test_simple_auth.py tests/unit/test_hello.py tests/unit/libkoiki/services/test_user_service_simple.py tests/integration/app/api/test_todos_api.py

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç¢ºèª
open htmlcov/index.html
</code></pre>
<h2 id="_13">ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h2>
<h3 id="_14">ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–</h3>
<h4 id="1-transactional">1. @transactionalãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã¨ãƒ¢ãƒƒã‚¯ã®ç«¶åˆ</h4>
<p><strong>å•é¡Œ</strong>: <code>TypeError: Function 'create_user' decorated with @transactional must accept an AsyncSession as an argument</code></p>
<p><strong>è§£æ±ºç­–</strong>: ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’ä½¿ç”¨</p>
<pre><code class="language-python"># âŒ è¤‡é›‘ãªãƒ¢ãƒƒã‚¯è¨­å®š
await user_service.create_user(user_data, mock_db_session)

# âœ… ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ®µéšçš„ã«ãƒ†ã‚¹ãƒˆ
user_service.repository.set_session(mock_db_session)
existing_user = await user_service.repository.get_by_email(user_data.email)
</code></pre>
<h4 id="2_1">2. çµ±åˆãƒ†ã‚¹ãƒˆã®ãƒ‡ãƒ¼ã‚¿ç«¶åˆ</h4>
<p><strong>å•é¡Œ</strong>: è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆãŒåŒæ™‚å®Ÿè¡Œæ™‚ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹ãŒç«¶åˆ</p>
<p><strong>è§£æ±ºç­–</strong>: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—</p>
<pre><code class="language-bash"># ãƒ†ã‚¹ãƒˆå‰ã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
docker-compose exec db psql -U koiki_user -d koiki_todo_db -c &quot;DELETE FROM refresh_tokens; DELETE FROM login_attempts; DELETE FROM users;&quot;

# å€‹åˆ¥ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
poetry run pytest tests/integration/services/test_user_service_db.py::TestUserServiceDatabase::test_create_user_success -v
</code></pre>
<h4 id="3-pytest-asyncio">3. pytest-asyncio ã®è­¦å‘Š</h4>
<p><strong>å•é¡Œ</strong>: <code>RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited</code></p>
<p><strong>è§£æ±ºç­–</strong>: é©åˆ‡ãªãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£è¨­å®š</p>
<pre><code class="language-python">@pytest_asyncio.fixture
async def test_repositories(test_db_session):
    # pytest_asyncio.fixtureã‚’ä½¿ç”¨
</code></pre>
<h2 id="_15">é–‹ç™ºæ™‚ã®æ¨å¥¨æ‰‹é †</h2>
<h3 id="_16">æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã™ã‚‹å ´åˆ</h3>
<ol>
<li>
<p><strong>ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‹ã‚‰é–‹å§‹</strong>:
   <code>bash
   # tests/unit/app/services/test_new_service_simple.py ã‚’ä½œæˆ
   poetry run pytest tests/unit/app/services/test_new_service_simple.py -v</code></p>
</li>
<li>
<p><strong>çµ±åˆãƒ†ã‚¹ãƒˆã‚’è¿½åŠ </strong>:
   <code>bash
   # tests/integration/app/services/test_new_service_db.py ã‚’ä½œæˆ
   poetry run pytest tests/integration/app/services/test_new_service_db.py::TestNewServiceDatabase::test_basic_function -v</code></p>
</li>
<li>
<p><strong>å‹•ä½œç¢ºèª</strong>:
   <code>bash
   # æ—¢å­˜ã®å‹•ä½œç¢ºèªæ¸ˆã¿ãƒ†ã‚¹ãƒˆã¨ä¸€ç·’ã«å®Ÿè¡Œ
   poetry run pytest tests/unit/test_simple_auth.py tests/unit/app/services/test_new_service_simple.py -v</code></p>
</li>
</ol>
<h2 id="_17">å‚™è€ƒï¼šãƒ†ã‚¹ãƒˆå®Ÿè£…ã§èª¿æ•´ã—ãŸãƒã‚¤ãƒ³ãƒˆ</h2>
<h3 id="1-transactional_1">1. @transactionalãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿å¯¾å¿œ</h3>
<p><strong>èª²é¡Œ</strong>: @transactionalãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãŒAsyncSessionã®å‹ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ãŸã‚ã€ãƒ¢ãƒƒã‚¯ã¨ç«¶åˆ</p>
<p><strong>è§£æ±ºç­–</strong>: 
- ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã§ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ®µéšçš„ã«ãƒ†ã‚¹ãƒˆ
- çµ±åˆãƒ†ã‚¹ãƒˆã§ã¯å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨</p>
<h3 id="2-pytest-asyncio">2. pytest-asyncio ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£</h3>
<p><strong>èª²é¡Œ</strong>: éåŒæœŸãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ãŒæ­£ã—ãå‹•ä½œã—ãªã„</p>
<p><strong>è§£æ±ºç­–</strong>:</p>
<pre><code class="language-python"># âŒ é€šå¸¸ã®ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
@pytest.fixture
async def test_services(test_repositories):

# âœ… pytest-asyncio ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
@pytest_asyncio.fixture
async def test_services(test_repositories):
</code></pre>
<h3 id="3_1">3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†</h3>
<p><strong>èª²é¡Œ</strong>: @transactionalãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãŒãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã€ãƒ†ã‚¹ãƒˆå´ã§ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ¶å¾¡ãŒè¡çª</p>
<p><strong>è§£æ±ºç­–</strong>:</p>
<pre><code class="language-python"># ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ã‚’å§”è­²
async with async_session_factory() as session:
    yield session
    # @transactionalãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãŒãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç®¡ç†
</code></pre>
<h2 id="_18">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºæ™‚ã®ãƒ†ã‚¹ãƒˆæ‰‹é †</h2>
<h3 id="1_1">1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ†ã‚¹ãƒˆ</h3>
<pre><code class="language-python"># app/services/my_service.py ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹å ´åˆ
# tests/unit/app/services/test_my_service_simple.py

class TestMyServiceSimple:
    &quot;&quot;&quot;ãƒã‚¤ã‚µãƒ¼ãƒ“ã‚¹ ã‚·ãƒ³ãƒ—ãƒ«ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ&quot;&quot;&quot;

    @patch('app.services.my_service.external_api_call')
    @pytest.mark.asyncio
    async def test_my_business_logic(self, mock_api_call):
        &quot;&quot;&quot;ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ&quot;&quot;&quot;
        # ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç›´æ¥ä½œæˆ
        from app.services.my_service import MyService

        # ãƒ¢ãƒƒã‚¯ã®è¨­å®š
        mock_api_call.return_value = {&quot;result&quot;: &quot;success&quot;}

        # ã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
        service = MyService(mock_repository)

        # ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ®µéšçš„ã«ãƒ†ã‚¹ãƒˆ
        # 1. å…¥åŠ›æ¤œè¨¼
        # 2. å¤–éƒ¨APIå‘¼ã³å‡ºã—
        # 3. ãƒ‡ãƒ¼ã‚¿å¤‰æ›
        # 4. çµæœæ¤œè¨¼
</code></pre>
<h3 id="2-api">2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³APIã®ãƒ†ã‚¹ãƒˆ</h3>
<pre><code class="language-python"># app/api/v1/endpoints/my_endpoint.py ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹å ´åˆ
# tests/integration/app/api/test_my_endpoint.py

@pytest.mark.integration
class TestMyEndpoint:
    &quot;&quot;&quot;ãƒã‚¤ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµ±åˆãƒ†ã‚¹ãƒˆ&quot;&quot;&quot;

    @pytest.mark.asyncio
    async def test_my_endpoint_success(self, test_client):
        &quot;&quot;&quot;ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæˆåŠŸãƒ†ã‚¹ãƒˆ&quot;&quot;&quot;
        response = test_client.post(&quot;/api/v1/my-endpoint&quot;, json={
            &quot;data&quot;: &quot;test_data&quot;
        })

        assert response.status_code == 200
        assert response.json()[&quot;result&quot;] == &quot;success&quot;
</code></pre>
<h3 id="3_2">3. æ¨å¥¨é–‹ç™ºãƒ•ãƒ­ãƒ¼</h3>
<ol>
<li><strong>ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’å…ˆã«ä½œæˆ</strong>ï¼ˆTDDçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼‰</li>
<li><strong>ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ®µéšçš„ã«ãƒ†ã‚¹ãƒˆ</strong></li>
<li><strong>çµ±åˆãƒ†ã‚¹ãƒˆã§å…¨ä½“ã®å‹•ä½œç¢ºèª</strong></li>
<li><strong>æ—¢å­˜ã®å‹•ä½œç¢ºèªæ¸ˆã¿ãƒ†ã‚¹ãƒˆã¨ä¸€ç·’ã«å®Ÿè¡Œ</strong></li>
</ol>
<pre><code class="language-bash"># é–‹ç™ºãƒ•ãƒ­ãƒ¼ä¾‹
poetry run pytest tests/unit/app/services/test_my_service_simple.py -v
poetry run pytest tests/integration/app/api/test_my_endpoint.py -v
poetry run pytest tests/unit/test_simple_auth.py tests/unit/app/services/test_my_service_simple.py -v
</code></pre>
<p>ã“ã®æ‰‹é †ã«ã‚ˆã‚Šã€@transactionalãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã‚„ãã®ä»–ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯æ©Ÿèƒ½ã«ä¾å­˜ã›ãšã€ç´”ç²‹ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ†ã‚¹ãƒˆã§ãã‚‹ã€ä¿å®ˆæ€§ã®é«˜ã„ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã§ãã¾ã™ã€‚</p>
<hr />
<p><strong>ğŸ‰ Happy Testing with KOIKI-FW v0.6.0!</strong></p>
<p><strong>é‡è¦</strong>: æ—¢ã«å®Ÿè£…æ¸ˆã¿ã®é«˜æ©Ÿèƒ½èªè¨¼APIã®ãƒ†ã‚¹ãƒˆä½œæˆã«ã‚ˆã‚Šã€ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ¬ãƒ‡ã‚£ãªãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>